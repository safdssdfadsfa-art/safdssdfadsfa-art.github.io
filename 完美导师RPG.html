<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç ”å­¦å¯¼å¸ˆè§’è‰²æ„å»ºå° - æ‰“é€ ä½ çš„â€œå…­è¾¹å½¢æˆ˜å£«â€</title>
    <style>
        :root {
            --color-s: #d32f2f; /* Sçº§çº¢ */
            --color-a: #f57c00; /* Açº§æ©™ */
            --color-b: #388e3c; /* Bçº§ç»¿ */
            --color-n: #7b1fa2; /* Nçº§ç´« */
            --bg-color: #f4f7f6;
            --text-color: #333;
        }

        body {
            font-family: 'Segoe UI', 'Microsoft YaHei', sans-serif;
            background-color: var(--bg-color);
            color: var(--text-color);
            margin: 0;
            padding: 20px;
            line-height: 1.5;
        }

        .container {
            max-width: 900px;
            margin: 0 auto;
            background: #fff;
            padding: 30px;
            border-radius: 16px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.08);
        }

        /* é¡¶éƒ¨çŠ¶æ€æ  */
        .status-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            padding: 15px 25px;
            background: #e3f2fd;
            border-radius: 12px;
            border-left: 6px solid #2196f3;
            position: sticky;
            top: 20px;
            z-index: 100;
            box-shadow: 0 4px 10px rgba(0,0,0,0.05);
        }

        .status-bar h2 {
            margin: 0;
            font-size: 1.5em;
        }

        .points-display {
            font-size: 1.8em;
            font-weight: bold;
            color: #2196f3;
        }

        .points-label {
            font-size: 0.9em;
            color: #666;
        }

        /* åŒºåŸŸæ ‡é¢˜ */
        .section-title {
            font-size: 1.3em;
            margin: 25px 0 15px;
            padding-bottom: 8px;
            border-bottom: 2px solid #eee;
            display: flex;
            align-items: center;
        }

        .tier-badge {
            display: inline-block;
            padding: 4px 10px;
            border-radius: 6px;
            color: white;
            font-size: 0.8em;
            margin-right: 10px;
            font-weight: bold;
        }

        /* ç‰¹è´¨ç½‘æ ¼ */
        .traits-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(260px, 1fr));
            gap: 15px;
        }

        /* ç‰¹è´¨å¡ç‰‡ */
        .trait-card {
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            padding: 15px;
            cursor: pointer;
            transition: all 0.2s;
            position: relative;
            background: #fff;
        }

        .trait-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.08);
        }

        .trait-card.selected {
            border-color: #2196f3;
            background-color: #e3f2fd;
        }

        /* ä¸åŒå±‚çº§çš„å¡ç‰‡æ ·å¼ */
        .tier-s .trait-card.selected { border-color: var(--color-s); background-color: #ffebee; }
        .tier-a .trait-card.selected { border-color: var(--color-a); background-color: #fff3e0; }
        .tier-b .trait-card.selected { border-color: var(--color-b); background-color: #e8f5e9; }
        .tier-n .trait-card { border-style: dashed; }
        .tier-n .trait-card.selected { border-color: var(--color-n); background-color: #f3e5f5; }


        .trait-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
        }

        .trait-name {
            font-weight: bold;
            font-size: 1.1em;
        }

        .trait-cost {
            font-weight: bold;
            padding: 3px 8px;
            border-radius: 20px;
            font-size: 0.9em;
        }
        .cost-pay { color: #d32f2f; background: #ffebee; }
        .cost-gain { color: #388e3c; background: #e8f5e9; }

        .trait-desc {
            font-size: 0.9em;
            color: #666;
        }

        /* åº•éƒ¨æŒ‰é’® */
        .footer-action {
            margin-top: 40px;
            text-align: center;
        }

        #finishBtn {
            background: #2196f3;
            color: white;
            border: none;
            padding: 15px 40px;
            font-size: 1.2em;
            border-radius: 50px;
            cursor: pointer;
            transition: background 0.3s;
            box-shadow: 0 5px 15px rgba(33, 150, 243, 0.3);
        }

        #finishBtn:hover { background: #1976d2; }
        #finishBtn:disabled { background: #ccc; cursor: not-allowed; box-shadow: none; }

        /* æç¤ºä¿¡æ¯ */
        #message-box {
            text-align: center;
            margin-top: 15px;
            color: #d32f2f;
            font-weight: bold;
            min-height: 24px;
        }

        /* ç»“æœå¼¹çª— */
        .modal {
            display: none;
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.6);
            justify-content: center;
            align-items: center;
            z-index: 1000;
            opacity: 0;
            transition: opacity 0.3s;
        }
        .modal.show { display: flex; opacity: 1; }
        
        .modal-content {
            background: white;
            padding: 30px;
            border-radius: 16px;
            max-width: 600px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
            position: relative;
        }
        .close-btn {
            position: absolute; top: 15px; right: 20px;
            font-size: 24px; cursor: pointer; color: #999;
        }
        .result-list { margin-left: 20px; }
        .result-item { margin-bottom: 8px; }
        .item-s { color: var(--color-s); font-weight: bold; }
        .item-a { color: var(--color-a); }
        .item-b { color: var(--color-b); }
        .item-n { color: var(--color-n); font-style: italic; }

    </style>
</head>
<body>

<div class="container">
    <div class="status-bar">
        <h2>å¯¼å¸ˆè§’è‰²æ„å»ºå°</h2>
        <div>
            <span class="points-label">å‰©ä½™å¤©èµ‹ç‚¹ (DP)ï¼š</span>
            <span id="points-display" class="points-display">30</span>
        </div>
    </div>

    <div id="app">
        </div>

    <div id="message-box"></div>

    <div class="footer-action">
        <button id="finishBtn" onclick="finishBuild()">å®Œæˆæ„å»ºï¼Œç”Ÿæˆè§’è‰²å¡</button>
        <p style="color: #666; font-size: 0.9em; margin-top: 10px;">(è§„åˆ™ï¼šè‡³å°‘é€‰1ä¸ªSçº§ï¼›Nçº§æœ€å¤šé€‰2ä¸ª)</p>
    </div>
</div>

<div id="resultModal" class="modal">
    <div class="modal-content">
        <span class="close-btn" onclick="closeModal()">&times;</span>
        <h2 style="text-align: center; color: #2196f3;">ä½ çš„ç ”å­¦å¯¼å¸ˆè§’è‰²å¡</h2>
        <div id="resultBody"></div>
        <button onclick="closeModal()" style="width: 100%; margin-top: 20px; padding: 12px; background: #2196f3; color: white; border: none; border-radius: 8px; cursor: pointer;">å…³é—­å¹¶æˆªå›¾ä¿å­˜</button>
    </div>
</div>

<script>
    // --- é…ç½®åŒºåŸŸï¼šç‰¹è´¨æ•°æ®åº“ ---
    const traitsDB = {
        S: {
            name: "Sçº§ï¼šæ ¸å¿ƒåŸºçŸ³",
            cost: 8,
            color: "var(--color-s)",
            desc: "ç«‹èº«ä¹‹æœ¬ï¼Œç¼ºäº†å°±å¡Œæˆ¿ã€‚",
            items: [
                { id: "s1", name: "åšå¦‚ç£çŸ³çš„å®‰å…¨æ„è¯†", desc: "å¯¹é£é™©æœ‰é›·è¾¾èˆ¬çš„å—…è§‰ï¼Œå­¦ç”Ÿå°‘æ ¹å¤´å‘ä½ éƒ½ç¡ä¸ç€ã€‚" },
                { id: "s2", name: "æ— æ¡ä»¶çš„çˆ±ä¸è€å¿ƒ", desc: "é¢å¯¹ç¬¬100æ¬¡æé—®ä¾ç„¶å¾®ç¬‘è§£ç­”ï¼Œè§†å¦‚å·±å‡ºã€‚" },
                { id: "s3", name: "ç»å¯¹çš„èŒä¸šæ“å®ˆ", desc: "æ— è®ºå¤šç´¯å¤šçƒ¦ï¼Œæ°¸è¿œæƒ…ç»ªç¨³å®šï¼Œä¸ä¼ é€’è´Ÿèƒ½é‡ã€‚" }
            ]
        },
        A: {
            name: "Açº§ï¼šä¸“ä¸šèµ‹èƒ½",
            cost: 5,
            color: "var(--color-a)",
            desc: "ä»â€œä¿å§†â€å‡çº§ä¸ºâ€œåå¸ˆâ€çš„å…³é”®ã€‚",
            items: [
                { id: "a1", name: "ç™¾ç§‘å…¨ä¹¦å¼çŸ¥è¯†å‚¨å¤‡", desc: "ä»å†œè€•åˆ°ç‰©ç†ï¼Œæ€»èƒ½æ¥ä½å­©å­å¥‡æ€ªçš„é—®é¢˜ã€‚" },
                { id: "a2", name: "æ•™ç§‘ä¹¦çº§æ§åœºèƒ½åŠ›", desc: "ä¸€ä¸ªçœ¼ç¥è®©ç™¾äººå›¢é˜Ÿç¬é—´å®‰é™èšç„¦ã€‚" },
                { id: "a3", name: "æ•…äº‹å¤§ç‹çš„è¡¨è¾¾åŠ›", desc: "æŠŠæ¯ç‡¥çŸ¥è¯†è®²æˆç²¾å½©æ•…äº‹ï¼Œå­©å­ä¸æƒ³ä¸‹è¯¾ã€‚" },
                { id: "a4", name: "æ•é”çš„æ•™è‚²æ´å¯ŸåŠ›", desc: "é€è¿‡è¡Œä¸ºçœ‹åˆ°å¿ƒç†éœ€æ±‚ï¼Œæ‡‚å¾—ä½•æ—¶ç»™äºˆæ”¯æ¶ã€‚" }
            ]
        },
        B: {
            name: "Bçº§ï¼šé”¦ä¸Šæ·»èŠ±",
            cost: 3,
            color: "var(--color-b)",
            desc: "é­…åŠ›åŠ åˆ†é¡¹ã€‚",
            items: [
                { id: "b1", name: "å¤šæ‰å¤šè‰ºæŠ€èƒ½åŒ…", desc: "ä¼šå‰ä»–/æ‘„å½±/é­”æœ¯ï¼Œå­©å­çœ¼ä¸­çš„å…¨èƒ½å¶åƒã€‚" },
                { id: "b2", name: "è¶…é«˜é¢œå€¼äº²å’ŒåŠ›", desc: "å¤©ç”Ÿä¸€å¼ è®©äººä¿¡ä»»çš„è„¸ï¼Œå­©å­æ„¿æ„é è¿‘ã€‚" },
                { id: "b3", name: "ç¤¾äº¤ç‰›é€¼ç—‡æ„ŸæŸ“åŠ›", desc: "æ°”æ°›ç»„ç»„é•¿ï¼Œæœ‰ä½ åœ¨æ°¸è¿œä¸ä¼šå†·åœºã€‚" },
                { id: "b4", name: "å¼ºè¿«ç—‡èˆ¬ç»†èŠ‚æ§", desc: "æµç¨‹æ»´æ°´ä¸æ¼ï¼Œè®©å®¶é•¿å’Œåˆä½œæ–¹æå…¶æ”¾å¿ƒã€‚" },
                { id: "b5", name: "é’¢é“ä¾ èˆ¬ä½“èƒ½", desc: "æ—¥è¡Œä¸¤ä¸‡æ­¥è¿å¸¦ä¸ƒå¤©å›¢ï¼Œä¾ç„¶ç²¾åŠ›å……æ²›ã€‚" }
            ]
        },
        N: {
            name: "Nçº§ï¼šè´Ÿé¢ç‰¹è´¨ (ä»£ä»·)",
            cost: -5, // è´Ÿæ•°è¡¨ç¤ºå¢åŠ ç‚¹æ•°
            color: "var(--color-n)",
            desc: "è‡´å‘½ç¼ºç‚¹ï¼Œæ¢å–é¢å¤–ç‚¹æ•°ã€‚æœ€å¤šé€‰2ä¸ªã€‚",
            items: [
                { id: "n1", name: "è‡´å‘½è„¸ç›²ç—‡", desc: "å¸¦å›¢ä¸‰å¤©è¿˜åˆ†ä¸æ¸…äººã€‚ä»£ä»·ï¼šå­¦ç”Ÿæ— å½’å±æ„Ÿã€‚" },
                { id: "n2", name: "ä¸¥é‡çŸ¥è¯†åç§‘", desc: "ä¸æ“…é•¿é¢†åŸŸé çç¼–ã€‚ä»£ä»·ï¼šè¯¯äººå­å¼Ÿé£é™©ã€‚" },
                { id: "n3", name: "æƒ…ç»ªä¸ç¨³å®šç‚¸å¼¹", desc: "æåº¦ç–²æƒ«æ—¶ä¼šå¤±æ§å¼äººã€‚ä»£ä»·ï¼šæ‘§æ¯å®‰å…¨æ„Ÿã€‚" },
                { id: "n4", name: "é‡åº¦ç¤¾ææ‚£è€…", desc: "æŠ—æ‹’è¯¾ä¸‹äº¤æµã€‚ä»£ä»·ï¼šéš¾å»ºç«‹æ·±å±‚å…³ç³»ã€‚" }
            ]
        }
    };

    // --- æ¸¸æˆçŠ¶æ€ ---
    let currentPoints = 30;
    const selectedTraits = new Set(); // å­˜å‚¨å·²é€‰ç‰¹è´¨çš„ID
    const maxNegative = 2; // Nçº§æœ€å¤§é€‰æ‹©æ•°

    // --- åˆå§‹åŒ–æ¸²æŸ“ ---
    function initGame() {
        const app = document.getElementById('app');
        for (const tierKey in traitsDB) {
            const tier = traitsDB[tierKey];
            const section = document.createElement('div');
            section.className = `tier-section tier-${tierKey.toLowerCase()}`;
            
            section.innerHTML = `
                <div class="section-title" style="border-color: ${tier.color}">
                    <span class="tier-badge" style="background: ${tier.color}">${tierKey}çº§</span>
                    ${tier.name}
                    <span style="margin-left: auto; font-size: 0.9em; color: ${tier.color}">
                        ${tier.cost > 0 ? 'æ¶ˆè€— ' + tier.cost : 'è·å¾— ' + Math.abs(tier.cost)} DP/ä¸ª
                    </span>
                </div>
                <p style="color: #666; font-size: 0.9em; margin-top: -10px; margin-bottom: 15px;">${tier.desc}</p>
                <div class="traits-grid">
                    ${tier.items.map(item => `
                        <div class="trait-card" id="${item.id}" onclick="toggleTrait('${item.id}', '${tierKey}', ${tier.cost})">
                            <div class="trait-header">
                                <span class="trait-name">${item.name}</span>
                                <span class="trait-cost ${tier.cost > 0 ? 'cost-pay' : 'cost-gain'}">
                                    ${tier.cost > 0 ? '-' + tier.cost : '+' + Math.abs(tier.cost)}
                                </span>
                            </div>
                            <div class="trait-desc">${item.desc}</div>
                        </div>
                    `).join('')}
                </div>
            `;
            app.appendChild(section);
        }
        updateUI();
    }

    // --- æ ¸å¿ƒé€»è¾‘ï¼šåˆ‡æ¢ç‰¹è´¨é€‰æ‹© ---
    function toggleTrait(id, tierKey, cost) {
        const msgBox = document.getElementById('message-box');
        msgBox.innerText = ""; // æ¸…ç©ºæç¤º

        if (selectedTraits.has(id)) {
            // å–æ¶ˆé€‰æ‹©ï¼šè¿”è¿˜ç‚¹æ•°
            currentPoints += cost;
            selectedTraits.delete(id);
        } else {
            // å°è¯•é€‰æ‹©
            // è§„åˆ™1ï¼šæ£€æŸ¥Nçº§æ•°é‡é™åˆ¶
            if (tierKey === 'N') {
                let nCount = 0;
                selectedTraits.forEach(tid => { if (tid.startsWith('n')) nCount++; });
                if (nCount >= maxNegative) {
                    msgBox.innerText = `âš ï¸ è§„åˆ™é™åˆ¶ï¼šè´Ÿé¢ç‰¹è´¨æœ€å¤šåªèƒ½é€‰æ‹© ${maxNegative} ä¸ªï¼`;
                    shakeUI(id); return;
                }
            }
            // è§„åˆ™2ï¼šæ£€æŸ¥ç‚¹æ•°æ˜¯å¦è¶³å¤Ÿ
            if (currentPoints < cost) {
                msgBox.innerText = "âš ï¸ å¤©èµ‹ç‚¹ä¸è¶³ï¼Œæ— æ³•è´­ä¹°æ­¤ç‰¹è´¨ï¼è¯·å…ˆæ”¾å¼ƒå…¶ä»–ç‰¹è´¨ã€‚";
                shakeUI(id); return;
            }
            // æ‰£é™¤ç‚¹æ•°å¹¶é€‰æ‹©
            currentPoints -= cost;
            selectedTraits.add(id);
        }
        updateUI();
    }

    // --- UI æ›´æ–° ---
    function updateUI() {
        // æ›´æ–°ç‚¹æ•°æ˜¾ç¤º
        const pointsDisplay = document.getElementById('points-display');
        pointsDisplay.innerText = currentPoints;
        pointsDisplay.style.color = currentPoints < 5 ? '#d32f2f' : '#2196f3';

        // æ›´æ–°å¡ç‰‡æ ·å¼
        document.querySelectorAll('.trait-card').forEach(card => {
            if (selectedTraits.has(card.id)) {
                card.classList.add('selected');
            } else {
                card.classList.remove('selected');
            }
        });
    }

    // --- UI ç‰¹æ•ˆï¼šé”™è¯¯æŠ–åŠ¨ ---
    function shakeUI(id) {
        const card = document.getElementById(id);
        card.style.transform = "translateX(5px)";
        setTimeout(() => { card.style.transform = "translateX(-5px)"; }, 50);
        setTimeout(() => { card.style.transform = "translateX(5px)"; }, 100);
        setTimeout(() => { card.style.transform = "translateX(0)"; }, 150);
    }

    // --- å®Œæˆæ„å»º ---
    function finishBuild() {
        const msgBox = document.getElementById('message-box');
        let sCount = 0;
        selectedTraits.forEach(id => { if (id.startsWith('s')) sCount++; });

        if (sCount < 1) {
            msgBox.innerText = "ğŸš« æ„å»ºå¤±è´¥ï¼šSçº§æ ¸å¿ƒåŸºçŸ³è‡³å°‘å¿…é¡»é€‰æ‹© 1 ä¸ªï¼";
            window.scrollTo(0, 0); // æ»šåŠ¨åˆ°é¡¶éƒ¨æç¤º
            return;
        }

        // ç”Ÿæˆç»“æœ HTML
        let resultHTML = `<p><strong>å‰©ä½™å¤©èµ‹ç‚¹ï¼š</strong> <span style="color: #2196f3; font-weight:bold;">${currentPoints}</span></p>`;
        resultHTML += `<h3>å·²é€‰ç‰¹è´¨ç»„åˆï¼š</h3><ul class="result-list">`;
        
        // æŒ‰å±‚çº§æ’åºå±•ç¤º
        const sortedIds = Array.from(selectedTraits).sort((a, b) => a.localeCompare(b));
        
        sortedIds.forEach(id => {
            let tierChar = id.charAt(0).toUpperCase();
            let traitName = "";
            traitsDB[tierChar].items.forEach(item => { if(item.id === id) traitName = item.name; });
            resultHTML += `<li class="result-item item-${tierChar.toLowerCase()}">[${tierChar}çº§] ${traitName}</li>`;
        });
        resultHTML += `</ul>`;
        
        resultHTML += `<p style="margin-top: 20px; color: #666; font-size: 0.9em;">* è¿™ä¸ªç»„åˆä»£è¡¨äº†ä½ åœ¨å½“å‰èµ„æºé™åˆ¶ä¸‹ï¼Œå¯¹ç ”å­¦å¯¼å¸ˆæ ¸å¿ƒä»·å€¼çš„ç†è§£ä¸å–èˆã€‚</p>`;

        document.getElementById('resultBody').innerHTML = resultHTML;
        
        // æ˜¾ç¤ºå¼¹çª—
        const modal = document.getElementById('resultModal');
        modal.style.display = 'flex';
        setTimeout(() => modal.classList.add('show'), 10);
    }

    function closeModal() {
        const modal = document.getElementById('resultModal');
        modal.classList.remove('show');
        setTimeout(() => modal.style.display = 'none', 300);
    }

    // å¯åŠ¨æ¸¸æˆ
    initGame();

</script>
</body>
</html>